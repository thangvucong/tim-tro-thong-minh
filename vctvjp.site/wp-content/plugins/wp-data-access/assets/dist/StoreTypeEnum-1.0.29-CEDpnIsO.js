import{l as r,ai as S,p as L,aD as B,aE as Se,aF as he,aG as Ne,ah as V,aH as G,aI as Pe,S as De,aA as Ce,a8 as Ie,A,aJ as Ae,b as Te,aK as xe,am as ve,aL as Je,aM as Re,aN as Ee,al as we}from"./lib-1.0.29-C3pCU2AT.js";import{a as Fe}from"./RestApi-1.0.29-D1Nj1ewF.js";const Ue=(p,R)=>({app_id:p,cnt_id:R}),Me=(p,R)=>({dbs:p,tbl:R}),Ge=(p,R)=>{r.debug(p,R);const x=Fe(),_e=(i,n,e,T)=>{var m,v,I,f,N,_,E,w,F,U,s,o,a,j,q,k,H,K,W,d,z,Q,X,Z,$,ee,le,se,re,te,oe,ne,ue,me,ie,ce,pe,be,ge,fe,ae;r.debug(e);const h=(m=e.access.insert)==null?void 0:m.some(t=>t.toUpperCase()==="POST"),O=(v=e.access.update)==null?void 0:v.some(t=>t.toUpperCase()==="POST"),b=(I=e.access.delete)==null?void 0:I.some(t=>t.toUpperCase()==="POST");e.src=Me(i,n),e.privs={select:!0,insert:h,update:O,delete:b};let l={};((_=(N=(f=e==null?void 0:e.settings)==null?void 0:f.ui)==null?void 0:N.global)==null?void 0:_.table)!==!1?(l=S({},L,(F=(w=(E=e==null?void 0:e.settings)==null?void 0:E.ui)==null?void 0:w.global)==null?void 0:F.table),(q=(j=(a=(o=(s=(U=e==null?void 0:e.settings)==null?void 0:U.ui)==null?void 0:s.global)==null?void 0:o.table)==null?void 0:a.table)==null?void 0:j.pagination)!=null&&q.rowsPerPage&&(l.table.pagination.rowsPerPage=[...e.settings.ui.global.table.table.pagination.rowsPerPage]),(d=(W=(K=(H=(k=e==null?void 0:e.settings)==null?void 0:k.ui)==null?void 0:H.global)==null?void 0:K.table)==null?void 0:W.table)!=null&&d.defaultOrderBy&&(l.table.defaultOrderBy=[...e.settings.ui.global.table.table.defaultOrderBy])):l=S({},L,{table:{transactions:{insert:h,update:O,delete:b},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(z=e==null?void 0:e.privs)==null?void 0:z.delete}}});const J=[];for(let t=0;t<e.columns.length;t++)J[t]=B(e.columns[t].column_name,e.table_labels[e.columns[t].column_name]??e.columns[t].column_name);const g=[];if(Array.isArray(l.columns)&&l.columns.length>0){for(let t=0;t<l.columns.length;t++){const M=Se(e,l.columns[t].columnName);M!==void 0?g.push(S({},J[M],l.columns[t])):g.push(S({},B(e.columns[t].column_name),l.columns[t]))}l.columns=g}else l.columns=J;l.table.largeTableSupport.saved===he.AUTO?l.table.largeTableSupport.actual=Ne(e):l.table.largeTableSupport.actual=l.table.largeTableSupport.saved,r.debug(l);let u={...V};((Z=(X=(Q=e==null?void 0:e.settings)==null?void 0:Q.ui)==null?void 0:X.global)==null?void 0:Z.form)!==!1&&(u=S({},V,(le=(ee=($=e==null?void 0:e.settings)==null?void 0:$.ui)==null?void 0:ee.global)==null?void 0:le.form));const y=[];for(let t=0;t<e.columns.length;t++)y[t]=G(e.columns[t].column_name,e.form_labels[e.columns[t].column_name]??e.columns[t].column_name);const P=[];if(Array.isArray(u.columns)&&u.columns.length>0){for(let t=0;t<u.columns.length;t++){const M=Se(e,u.columns[t].columnName);M!==void 0?P.push(S({},y[M],u.columns[t])):P.push(S({},G(u.columns[t].column_name),u.columns[t]))}u.columns=P}else u.columns=y;const D=Pe.getSelectors().selectSelected(De.getState().explorer);r.debug("selected",D),D&&D[i]==="wp"&&((re=(se=e==null?void 0:e.settings)==null?void 0:se.wp)==null?void 0:re.tables)!==void 0&&Array.isArray(e.settings.wp.tables)&&e.settings.wp.tables.includes(n)&&(u.form={...Ce},u.form.preserveSpacesOnUpdate=!0);let C={};if(((ne=(oe=(te=e==null?void 0:e.settings)==null?void 0:te.ui)==null?void 0:oe.global)==null?void 0:ne.theme)!==void 0&&((ie=(me=(ue=e==null?void 0:e.settings)==null?void 0:ue.ui)==null?void 0:me.global)==null?void 0:ie.theme)!==null&&((be=(pe=(ce=e==null?void 0:e.settings)==null?void 0:ce.ui)==null?void 0:pe.global)==null?void 0:be.theme)!=="")try{C=JSON.parse((ae=(fe=(ge=e==null?void 0:e.settings)==null?void 0:ge.ui)==null?void 0:fe.global)==null?void 0:ae.theme)}catch(t){r.error("Invalid JSON - theme settings"),r.error(t)}C===!1&&(C={});const c=S({},Ie,C);return Y(e,l,u,c,T===!0)},Oe=(i,n,e,T,h,O)=>{var E,w,F,U;r.debug(i,n,e,T,h);const b=n.app.app[0];r.debug(b);const l=n.app.container[0];r.debug(l);let J={};try{J=JSON.parse(b.app_settings)}catch(s){r.error("Invalid JSON - app settings"),r.error(s)}r.debug(J);let g={};try{g=JSON.parse(l.cnt_cls)}catch(s){r.error("Invalid JSON - app columns"),r.error(s)}r.debug(g);const u=b.app_type,y=Number(u)===A.DATAENTRY||Number(u)===A.MASTERDETAIL||Number(u)===A.REGISTRATION,P=Number(u)===A.DATAENTRY||Number(u)===A.MASTERDETAIL||Number(u)===A.REGISTRATION||Number(u)===A.UPDATEFORM,D=Number(u)===A.DATAENTRY||Number(u)===A.MASTERDETAIL||Number(u)===A.REGISTRATION;r.debug(y,P,D),n.src=Ue(i,l.cnt_id),n.privs={select:!0,insert:y,update:P,delete:D};const C=S({},L,{table:{transactions:{insert:y,update:P,delete:D},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(E=n==null?void 0:n.privs)==null?void 0:E.delete}}});r.debug(C);let c={};if(l.cnt_table!==void 0&&l.cnt_table!==null&&l.cnt_table!=="")try{c=JSON.parse(l.cnt_table)}catch(s){r.error("Invalid JSON - table settings"),r.error(s)}r.debug(c);const m=S({},C,c);(F=(w=c==null?void 0:c.table)==null?void 0:w.pagination)!=null&&F.rowsPerPage&&(m.table.pagination.rowsPerPage=[...c.table.pagination.rowsPerPage]),(U=c==null?void 0:c.table)!=null&&U.defaultOrderBy&&(m.table.defaultOrderBy=[...c.table.defaultOrderBy]),r.debug(m);const v=[];for(let s=0;s<g.length;s++)g[s].isSelected===!0&&v.push(B(g[s].columnName,n.table_labels[g[s].columnName]??g[s].columnName,!0));if(r.debug(v),Array.isArray(m.columns)&&m.columns.length>0){const s=[];for(let o=0;o<m.columns.length;o++)if(m.columns[o].computedField!==void 0)s.push(S({},B(m.columns[o].columnName),m.columns[o]));else{const a=Ae(v,m.columns[o].columnName);a!==void 0&&s.push(S({},v[a],m.columns[o]))}v.map(o=>{s.filter(a=>a.columnName===o.columnName).length===0&&s.push(o)}),r.debug(s),m.columns=s}else m.columns=v;if(m.table.largeTableSupport.saved===he.AUTO?m.table.largeTableSupport.actual=Ne(n):m.table.largeTableSupport.actual=m.table.largeTableSupport.saved,(n==null?void 0:n.isRelationSelectionTable)===!0&&(c==null?void 0:c.columns)!==void 0&&Array.isArray(c.columns)){const s=[];c.columns.map(o=>{if(o.columnName.startsWith(Te.relationTablePrefix)){const a={...o};a.columnName=o.columnName.substring(Te.relationTablePrefix.length),s.push(a)}}),m.columns=[...s]}r.debug(m);let I={};if((l==null?void 0:l.cnt_form)!==void 0&&(l==null?void 0:l.cnt_form)!==null&&(l==null?void 0:l.cnt_form)!==""||n.useRform===!0&&(l==null?void 0:l.cnt_rform)!==void 0&&(l==null?void 0:l.cnt_rform)!==null&&(l==null?void 0:l.cnt_rform)!=="")try{n.useRform===!0?I=JSON.parse(l.cnt_rform):I=JSON.parse(l.cnt_form)}catch(s){r.error("Invalid JSON - form settings"),r.error(s)}r.debug(I);const f=S({},V,I);r.debug(f);const N=[];for(let s=0;s<g.length;s++)g[s].isSelected===!0&&N.push(G(g[s].columnName,n.form_labels[g[s].columnName]??g[s].columnName,!0));if(r.debug(N),Array.isArray(f.columns)&&f.columns.length>0){const s=[];for(let o=0;o<f.columns.length;o++)if(f.columns[o].computedField!==void 0)s.push(S({},N[o],f.columns[o]));else{const a=Ae(N,f.columns[o].columnName);a!==void 0&&s.push(S({},N[a],f.columns[o]))}N.map(o=>{s.filter(a=>a.columnName===o.columnName).length===0&&s.push(o)}),f.columns=s}else f.columns=N;r.debug(f);let _={};if((b==null?void 0:b.app_theme)!==void 0&&(b==null?void 0:b.app_theme)!==null&&(b==null?void 0:b.app_theme)!=="")try{_=JSON.parse(b.app_theme)}catch(s){r.error("Invalid JSON - theme settings"),r.error(s)}return _===!1&&(_={}),r.debug(_),h!==void 0&&(n.appRootId=h),Y(n,m,f,_,e===!0,O)},ye=(i,n)=>{r.debug(i);const e=i.app.app[0];r.debug(e);let T={};try{T=JSON.parse(e.app_settings)}catch(h){r.error("Invalid JSON - app settings"),r.error(h)}return r.debug(T),x(xe({appId:p,apps:i.app.apps,titles:i.app.titles,appSettings:T})),x(ve({appId:p,metaData:{...i,isExploring:n??!1}})),!0},Y=(i,n,e,T,h,O)=>(r.debug(i),x(ve({appId:p,metaData:{...i}})),x(Je({appId:p,tableState:n,tableAccess:{insert:i.privs.insert,update:i.privs.update,delete:i.privs.delete},isView:Re(i),exploring:h})),x(Ee({appId:p,formState:e})),x(we({appId:p,themeState:T})),O!==void 0&&O(),!0);return{prepareAdminStore:_e,prepareAppStore:Oe,prepareApp:ye}};var Be=(p=>(p[p.ADMIN=0]="ADMIN",p[p.APP=1]="APP",p))(Be||{});export{Ue as D,Be as S,Ge as u};
