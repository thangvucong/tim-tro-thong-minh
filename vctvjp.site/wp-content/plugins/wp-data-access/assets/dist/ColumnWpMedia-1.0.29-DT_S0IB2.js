import{j as r}from"./cm-1.0.29-B-jRz_ox.js";import{r as _}from"./redux-1.0.29-C1Q38y1F.js";import{l as e,C as k,L as E,bs as J,cg as M}from"./lib-1.0.29-C3pCU2AT.js";import{a as R}from"./RestApi-1.0.29-D1Nj1ewF.js";import{c as B,d as L,e as T,f as z,g as D}from"./index-1.0.29-BOWxC8Fi.js";import{M as U}from"./index.esm-1.0.29-BcBy0Voo.js";import"./useTheme-1.0.29-BG2eLrmM.js";import{F as $}from"./FormHelperText-1.0.29-DrHduTUH.js";import{B as S}from"./CardContent-1.0.29-D9omFsvB.js";import"./vendor-1.0.29-BmpNFhoq.js";import"./loglevel-1.0.29-BZ7XahX3.js";import"./lodash-1.0.29-CLFJOMhY.js";import"./moment-1.0.29-C5S46NFB.js";import"./iconBase-1.0.29-DWX4ew0u.js";import"./Typography-1.0.29-DKDDWYKJ.js";import"./index-1.0.29-D3hJYFO0.js";import"./index-1.0.29-Dlm2kjka.js";import"./notistack-1.0.29-DTteiN_s.js";import"./useFormControl-1.0.29-DBjraibe.js";const q="Upload or select %s from your WordPress media library",ps=({appId:d,columnName:o,columnValue:m,columnMetaData:f,onColumnChange:x,columnMedia:u,mediaType:p,locale:w,language:G,formMode:h,storeColumn:y})=>{e.debug(d,o,m,f,u,p);const I=_.useRef(null),v=R(),N=_.useMemo(()=>U,[]),F=s=>{if(e.debug(s),s!=null&&s.id&&(s!=null&&s.url)&&(s!=null&&s.mime)&&(s!=null&&s.title))return{value:s.id,media:{url:s.url,mime_type:s.mime,title:s.title}}},A=()=>{e.debug("update media");const s=J(f.data_type)!=="number";e.debug(s);let t="media",a="";switch(p){case"WP-Image":t="images(s)",a="image";break;case"WP-Audio":t="audio",a="audio";break;case"WP-Video":t="video(s)",a="video";break}e.debug(t,a);const n=window.wp.media({title:q.replace("%s",t),button:{text:"Select"},library:{type:a},multiple:s,render:!1});e.debug(n),n.on("select",function(){const l=[];if(s){const i=n.state().get("selection").toJSON();e.debug(i),i.map(P=>{e.debug(P);const W=F(P);W&&l.push(W)})}else{const i=F(n.state().get("selection").first().toJSON());i&&l.push(i)}e.debug(l);const c=[],g=[];for(let i=0;i<l.length;i++)c.push(l[i].value),g.push(JSON.stringify(l[i].media));e.debug(c,g),x(o,c.toString()),v(M({appId:d,columnName:o,columnValue:g}))}),n.open()},V=()=>{e.debug("delete media"),x(o,null),v(M({appId:d,columnName:o,columnValue:[]}))},C=s=>{switch(p){case"WP-Image":return r.jsx("img",{src:s.url,title:s.title,alt:s.title});case"WP-Attachment":{const t=s.mime_type.split("/");return r.jsxs("a",{href:s.url,title:s.title,target:"_blank",className:"pp-hyperlink",children:[r.jsxs("div",{children:[t[0]==="image"&&r.jsx(B,{}),t[0]==="audio"&&r.jsx(L,{}),t[0]==="video"&&r.jsx(T,{}),t[0]==="application"?t[1]==="pdf"?r.jsx(z,{}):r.jsx(D,{}):r.jsx(r.Fragment,{})]}),r.jsx("div",{className:"link-label",children:s.title})]})}case"WP-Audio":return r.jsx("audio",{controls:!0,children:r.jsx("source",{src:s.url,type:s.mime_type})});case"WP-Video":return r.jsx("video",{controls:!0,children:r.jsx("source",{src:s.url,type:s.mime_type})})}};return r.jsxs("div",{className:`media ${p}`,children:[r.jsxs($,{children:[u==null?void 0:u.map(s=>{try{if(s===null||s==="")return null;const t=JSON.parse(s);return t!=null&&t.url?r.jsx("div",{ref:I,className:"content",children:C(t)},t.url):null}catch(t){return e.error("Invalid media properties",t),r.jsx("span",{children:"Error reading media"})}}),r.jsx("input",{type:"hidden",value:m??""})]}),r.jsxs("div",{className:"actions",children:[r.jsx(S,{variant:"outlined",onClick:A,disabled:!k.appPlugin||h===E.VIEW||y.updatable===!1,children:N.select}),r.jsx(S,{variant:"outlined",onClick:V,disabled:!k.appPlugin||h===E.VIEW||y.updatable===!1,children:w.delete})]})]})};export{ps as default};
